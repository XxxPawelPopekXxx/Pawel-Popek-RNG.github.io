<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Paweł RNG - Mega Slot Edition</title>
<style>
body {
  font-family: Arial, sans-serif;
  background: #121212;
  color: #fff;
  margin: 0;
  padding: 0;
  text-align: center;
}
h1 { margin-top: 20px; font-size: 2em; }
button {
  padding: 15px 30px;
  font-size: 1.2em;
  margin: 10px;
  cursor: pointer;
  border: none;
  border-radius: 10px;
  transition: transform 0.2s;
}
#rollButton { background-color: #4CAF50; color: white; }
#rollButton:active { transform: scale(0.9); }
#muteButton { background-color: #f44336; color: white; }
.upgradeButton { background-color: #2196F3; color: white; }
#resultImage {
  width: 300px;
  height: 300px;
  margin: 20px auto;
  object-fit: cover;
  border-radius: 15px;
  display: block;
  transition: all 0.1s;
}
#resultText { font-size: 1.5em; margin-top: 10px; }
#chanceText, #rarityText { font-size: 1.2em; margin-top: 5px; }
#currency { margin-top: 20px; font-size: 1.3em; }
#upgrades { margin-top: 20px; font-size: 1em; display: flex; flex-wrap: wrap; justify-content: center; }
#upgrades button { margin: 5px; }
#inventory, #history, #cooldownDisplay { margin-top: 15px; font-size: 1.1em; }
#history {
  max-height: 200px;
  overflow-y: auto;
  border: 1px solid #555;
  padding: 10px;
  border-radius: 10px;
  width: 90%;
  margin: 10px auto;
  background-color: #222;
}
#stats {
  position: fixed;
  top: 10px;
  right: 10px;
  background-color: #222;
  border: 1px solid #555;
  padding: 10px;
  border-radius: 10px;
  text-align: left;
  width: 220px;
  font-size: 0.9em;
}
#volumeControl { width: 150px; margin: 10px auto; }
#resetButton {
  position: fixed;
  bottom: 10px;
  left: 10px;
  background-color: #f44336;
  color: white;
  font-weight: bold;
  border-radius: 10px;
  padding: 15px 25px;
  cursor: pointer;
  z-index: 100;
}
#resetModal {
  position: fixed;
  top:0; left:0;
  width:100%; height:100%;
  background: rgba(0,0,0,0.85);
  display: none;
  justify-content: center;
  align-items: center;
  z-index: 200;
}
#resetModalContent {
  background: #222;
  padding: 30px;
  border-radius: 15px;
  text-align: center;
  width: 400px;
}
#resetModalContent h2 { color: #f44336; }
#resetModalContent button {
  margin: 10px;
  padding: 10px 25px;
  font-size: 1em;
  border-radius: 10px;
  border: none;
  cursor: pointer;
}
#resetYes { background-color: #4CAF50; color: white; }
#resetNo { background-color: #f44336; color: white; }
</style>
</head>
<body>

<h1>Paweł RNG - Mega Slot</h1>

<div id="stats">
  <div>Monety: <span id="statsCoins">0</span></div>
  <div>Przedmioty: <span id="statsItems">0</span></div>
  <div>Łączne losowania: <span id="statsRolls">0</span></div>
</div>

<button id="rollButton">Roll</button>
<div id="cooldownDisplay">Cooldown: 0s</div>
<img id="resultImage" src="photo.png" alt="Result">
<div id="resultText">Kliknij Roll</div>
<div id="chanceText"></div>
<div id="rarityText"></div>

<button id="muteButton">Mute/Unmute</button>
<div>
  Głośność: <input type="range" id="volumeControl" min="1" max="100" value="50">
</div>

<button id="toggleAutoRoll">Włącz Auto-Roll (5000 monet)</button>

<div id="currency">Monety: <span id="coins">0</span></div>

<div id="upgrades">
  <button class="upgradeButton" id="shortenCooldown">Skróć cooldown (50 monet)</button>
  <button class="upgradeButton" id="increaseChances">Ulepszenie szans (100 monet)</button>
  <button class="upgradeButton" id="buyItem">Kup Tajemniczy Przedmiot (100 monet)</button>
</div>

<div id="inventory">Ekwipunek: brak</div>
<div id="history">Historia losowań:</div>

<button id="resetButton">Reset Progress</button>

<div id="resetModal">
  <div id="resetModalContent">
    <h2>UWAGA!</h2>
    <p>Ta operacja usunie wszystkie monety, ekwipunek, historię losowań i statystyki!</p>
    <p>Czy na pewno chcesz kontynuować?</p>
    <button id="resetYes">Tak, usuń wszystko</button>
    <button id="resetNo">Nie, anuluj</button>
  </div>
</div>

<audio id="backgroundMusic" loop></audio>

<script>
// ===== DANE =====
const images = [
  {src: 'photo.png', text: 'gejmingowy paweł', chance: 1/2, rarity: 'Common', reward: 1},
  {src: 'photo2.png', text: 'paweł prezydent', chance: 1/4, rarity: 'Uncommon', reward: 5},
  {src: 'photo3.png', text: 'pawel w zoltym hoodie', chance: 1/8, rarity: 'Rare', reward: 10},
  {src: 'photo4.png', text: 'funni paweł', chance: 1/16, rarity: 'Epic', reward: 20},
  {src: 'photo5.png', text: 'paweł ok', chance: 1/32, rarity: 'Mythic', reward: 40},
  {src: 'photo6.png', text: 'świąteczny paweł', chance: 1/64, rarity: 'Legendary', reward: 80},
  {src: 'photo7.png', text: 'paweł dostaje backshoty', chance: 1/128, rarity: 'Ultra Legendary', reward: 160},
  {src: 'photo8.png', text: 'paweł komunista', chance: 1/256, rarity: 'Ultra Legendary', reward: 320},
  {src: 'photo9.png', text: 'Śledziu', chance: 1/1000000000000000, rarity: 'Secret', reward: 500, requiresItem: 'Tajemniczy Przedmiot'}
];

const musicFiles = ['music.mp3','music2.mp3','music3.mp3','music4.mp3','music5.mp3'];
const bgMusic = document.getElementById('backgroundMusic');
let musicStarted = false;

// ===== ZMIENNE =====
let coins = parseInt(localStorage.getItem('coins'))||0;
let inventory = JSON.parse(localStorage.getItem('inventory'))||[];
let historyData = JSON.parse(localStorage.getItem('historyData'))||{};
let cooldown = parseInt(localStorage.getItem('cooldown'))||1000; 
let lastRoll = 0;
let totalRolls = parseInt(localStorage.getItem('totalRolls'))||0;
let autoRollInterval = null;

// ===== FUNKCJE =====
function updateUI(){
  document.getElementById('coins').textContent = coins;
  document.getElementById('inventory').textContent = inventory.length?`Ekwipunek: ${inventory.join(', ')}`:'Ekwipunek: brak';
  let historyHTML='';
  for(const[key,val] of Object.entries(historyData)){
    historyHTML+=`${key} (x${val})<br>`;
  }
  document.getElementById('history').innerHTML = historyHTML||'Historia losowań: brak';
  localStorage.setItem('coins',coins);
  localStorage.setItem('inventory',JSON.stringify(inventory));
  localStorage.setItem('historyData',JSON.stringify(historyData));
  localStorage.setItem('cooldown',cooldown);
  localStorage.setItem('totalRolls', totalRolls);

  document.getElementById('statsCoins').textContent = coins;
  document.getElementById('statsItems').textContent = inventory.length;
  document.getElementById('statsRolls').textContent = totalRolls;
}

function showCooldown(){
  const now=Date.now();
  const diff=lastRoll?Math.max(0,cooldown-(now-lastRoll)):0;
  document.getElementById('cooldownDisplay').textContent=`Cooldown: ${(diff/1000).toFixed(1)}s`;
}

// ===== SLOT MEGA =====
function rollRNG(){
  const now=Date.now();
  if(now-lastRoll<cooldown) return;
  lastRoll=now;
  totalRolls++;

  const animPool = images.filter(img => !img.requiresItem || img.text!=='Śledziu');
  const finalPool = images.filter(img => !img.requiresItem || inventory.includes(img.requiresItem));

  const imgElem=document.getElementById('resultImage');
  const textElem=document.getElementById('resultText');
  const chanceElem=document.getElementById('chanceText');
  const rarityElem=document.getElementById('rarityText');

  let elapsed=0;
  const animSpeed=50;
  const totalDuration=1000;
  const interval=setInterval(()=>{
    const temp=animPool[Math.floor(Math.random()*animPool.length)];
    imgElem.src=temp.src;
    textElem.textContent=temp.text;
    chanceElem.textContent=`Szansa: 1/${Math.round(1/temp.chance)}`;
    rarityElem.textContent=`Rzadkość: ${temp.rarity}`;
    if(temp.rarity!=='Common' && temp.rarity!=='Uncommon'){
      imgElem.style.transform=`scale(${1+Math.random()*0.2}) rotate(${(Math.random()-0.5)*20}deg)`;
      imgElem.style.filter=`brightness(${1+Math.random()*0.5})`;
    } else {
      imgElem.style.transform='scale(1) rotate(0deg)';
      imgElem.style.filter='brightness(1)';
    }

    elapsed+=animSpeed;
    if(elapsed>=totalDuration){
      clearInterval(interval);
      const selected=finalPool[Math.floor(Math.random()*finalPool.length)];
      imgElem.src=selected.src;
      textElem.textContent=selected.text;
      chanceElem.textContent=`Szansa: 1/${selected.chance>=1?1:selected.chance<1?Math.round(1/selected.chance):0}`;
      rarityElem.textContent=`Rzadkość: ${selected.rarity}`;
      let reward=selected.reward;
      if(inventory.length>0) reward=Math.floor(reward*(1+0.05*inventory.length));
      coins+=reward;
      if(historyData[selected.text]) historyData[selected.text]++;
      else historyData[selected.text]=1;

      if(selected.text==='Śledziu'){
        let flashCount = 0;
        const flashInterval = setInterval(()=>{
          imgElem.style.transform = `scale(${1+0.3*Math.random()}) rotate(${(Math.random()-0.5)*60}deg)`;
          imgElem.style.filter = `brightness(${1+Math.random()*2})`;
          flashCount++;
          if(flashCount>15){
            clearInterval(flashInterval);
            imgElem.style.transform='scale(1) rotate(0deg)';
            imgElem.style.filter='brightness(1)';
          }
        },100);
      } else {
        imgElem.style.transform='scale(1) rotate(0deg)';
        imgElem.style.filter='brightness(1)';
      }

      updateUI();
    }
  },animSpeed);
}

// ===== AUTO-ROLL =====
function startAutoRoll(){
  if(autoRollInterval) return;
  if(coins<5000){ alert('Nie masz 5000 monet aby włączyć Auto-Roll!'); return;}
  coins -= 5000;
  updateUI();
  autoRollInterval = setInterval(()=>rollRNG(), 1500);
  document.getElementById('toggleAutoRoll').textContent = 'Wyłącz Auto-Roll';
}
function stopAutoRoll(){
  if(autoRollInterval){
    clearInterval(autoRollInterval);
    autoRollInterval = null;
    document.getElementById('toggleAutoRoll').textContent = 'Włącz Auto-Roll (5000 monet)';
  }
}

// ===== BUTTONS =====
document.getElementById('rollButton').addEventListener('click', async () => {
    if(!musicStarted){
        const randomMusic = musicFiles[Math.floor(Math.random()*musicFiles.length)];
        bgMusic.src = randomMusic;
        try{ await bgMusic.play(); musicStarted = true;} catch(err){ console.log(err);}
    }
    const btn=document.getElementById('rollButton');
    btn.style.transform='scale(0.8)';
    setTimeout(()=>btn.style.transform='scale(1)',250);
    rollRNG();
});

document.getElementById('muteButton').addEventListener('click',()=>{ bgMusic.muted=!bgMusic.muted; });
document.getElementById('volumeControl').addEventListener('input',()=>{ bgMusic.volume = document.getElementById('volumeControl').value/100; });

document.getElementById('toggleAutoRoll').addEventListener('click',()=>{
  if(autoRollInterval) stopAutoRoll();
  else startAutoRoll();
});

// ===== ULEPSZENIA =====
document.getElementById('shortenCooldown').addEventListener('click',()=>{
  if(coins>=50 && cooldown>1000){ coins-=50; cooldown-=500; stopAutoRoll(); updateUI(); alert(`Cooldown skrócony! Teraz ${(cooldown/1000).toFixed(1)}s`);}
  else if(cooldown<=1000) alert('Cooldown już minimalny!');
  else alert('Nie masz wystarczająco monet!');
});

document.getElementById('increaseChances').addEventListener('click',()=>{
  if(coins>=100){ coins-=100; images.forEach(img=>{ if(img.text!=='Śledziu') img.chance=Math.round(img.chance*1.05*100000)/100000 }); updateUI(); alert('Szanse nieco ulepszone!');}
  else alert('Nie masz wystarczająco monet!');
});

document.getElementById('buyItem').addEventListener('click',()=>{
  if(coins>=100){
      if(!inventory.includes('Tajemniczy Przedmiot')){
          coins-=100; 
          inventory.push('Tajemniczy Przedmiot'); 
          updateUI(); 
          alert('Tajemniczy Przedmiot dodany do ekwipunku!');
      } else {
          alert('Masz już Tajemniczy Przedmiot!');
      }
  } else alert('Nie masz wystarczająco monet!');
});

// ===== RESET PROGRESS =====
const resetModal = document.getElementById('resetModal');
document.getElementById('resetButton').addEventListener('click',()=>{ resetModal.style.display='flex'; });
document.getElementById('resetNo').addEventListener('click',()=>{ resetModal.style.display='none'; });
document.getElementById('resetYes').addEventListener('click',()=>{
  coins=0;
  inventory=[];
  historyData={};
  cooldown=1000;
  totalRolls=0;
  lastRoll=0;
  stopAutoRoll();
  localStorage.clear();
  updateUI();
  resetModal.style.display='none';
  alert('Wszystko zostało zresetowane!');
});

// ===== ODŚWIEŻANIE COOLDOWN =====
setInterval(showCooldown,100);
updateUI();
</script>

</body>
</html>
